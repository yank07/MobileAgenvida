angular.module("Agenvida.controllerLogin",[]).controller("controllerLogin",["$scope","$state","$http","$window","$rootScope","$ionicLoading","$translate",function(e,o,a,n,s,r,t){n.localStorage.token&&(e.message="Welcome Ya tengo el token"),e.user={},e.user.username=n.localStorage.username,e.user.password=n.localStorage.password,e.language=n.localStorage.language,"undefined"==typeof e.user.password&&(e.user.password=""),e.mensajeShow=!1,e.LoadingShow=function(){r.show({content:"Loading Data",animation:"fade-in",showBackdrop:!1,maxWidth:200,showDelay:500})},e.LoadingHide=function(){r.hide()},e.ChangeLanguage=function(e){n.localStorage.language=e,t.use(e.codigo)},e.signIn=function(){""!=e.user.username&&""!=e.user.password?(e.LoadingShow(),a({method:"POST",url:s.domain+"o/token/",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:"client_id="+s.client_id+"&grant_type=password&username="+e.user.username+"&password="+e.user.password+"&client_secret="}).then(function(a){n.localStorage.username=e.user.username,n.localStorage.password=e.user.password,n.localStorage.token=a.data.access_token,n.localStorage.refresh_token=a.data.refresh_token,e.LoadingHide(),e.message=t.instant("success_login"),e.message_lindo="",e.color_mensaje="green",e.mensajeShow=!0,e.mensajeShow=!1,e.LoadingHide(),o.transitionTo("app.marcacion")},function(o){delete n.localStorage.token,e.message=t.instant(o.data.error),e.message_lindo=t.instant("auth_error"),e.color_mensaje="red",e.mensajeShow=!0,e.LoadingHide()})):(e.message_lindo=t.instant("user_password_message"),e.color_mensaje="red",e.mensajeShow=!0)},e.signup=function(){o.go("signup")},e.forgotPasword=function(){o.go("forgot-password")},e.signIn()}]);