angular.module("Agenvida.controllerPerfil",[]).controller("controllerPerfil",["$scope","$rootScope","$state","$http","$window","$ionicHistory","$ionicPopup","$translate","ionicMaterialInk","ionicMaterialMotion",function(t,e,n,i,o,a,r,l,s,c){t.goMarcacion=function(){n.go("marcacion")},t.goConfiguracion=function(){n.go("app.configuracion")},t.goContratoPedagogico=function(){n.go("app.contrato-pedagogico")},t.cerraSesion=function(){delete o.localStorage.token,delete o.localStorage.password,n.go("signin")},t.verRecordatorioMail=function(){n.go("app.recordatorio-mail")},t.verNotificaciones=function(){n.go("app.notificaciones")},t.idiomas=[{name:"Español",codigo:"es"},{name:"Ingles",codigo:"en"}],t.actualizar=function(n){n?(e.LoadingShow(),i.get(e.domain+"userProfile/").then(function(e){t.perfil=e.data,s.displayEffect()},function(t){e.banner([l.instant("net_error"),l.instant("try_again")]),e.LoadingHide()}),i.get(e.domain+"users/").then(function(n){t.user=n.data,o.localStorage.user=JSON.stringify(t.user),e.LoadingHide()},function(t){e.LoadingHide(),e.banner([l.instant("net_error"),l.instant("try_again")])}),t.$broadcast("scroll.refreshComplete")):o.localStorage.perfil&&o.localStorage.user?(t.perfil=JSON.parse(o.localStorage.perfil),t.user=JSON.parse(o.localStorage.user)):t.actualizar(!0)},t.editar=function(n){"nacimiento"==n?(t.inputType="date",null!=t.perfil.nacimiento?(t.nacimiento=t.perfil.nacimiento.split("-"),t.nacimiento=new Date(t.nacimiento[0],t.nacimiento[1]-1,t.nacimiento[2])):t.nacimiento=new Date(1990,10,18),t.perfil.nacimiento=t.nacimiento):t.inputType="text","reafirmar"==n||"adquirir"==n||"liberar"==n?t.template='<textarea ng-model="perfil.'+n+'" rows="4"></textarea>':t.template='<input type="'+t.inputType+'" ng-model="perfil.'+n+'">';r.show({template:t.template,title:l.instant("edit"),subTitle:"",scope:t,buttons:[{text:l.instant("cancel")},{text:"<b>"+l.instant("save")+"</b>",type:"button-positive",onTap:function(a){"nacimiento"==n?(t.nacimiento=t.perfil.nacimiento.getFullYear()+"-"+(t.perfil.nacimiento.getMonth()+1)+"-"+t.perfil.nacimiento.getDate(),data={nacimiento:t.nacimiento},i.put(e.domain+"userProfile/",data).then(function(e){t.perfil=e.data})):i.put(e.domain+"userProfile/",t.perfil).then(function(e){t.perfil=e.data}),o.localStorage.perfil=JSON.stringify(t.perfil)}}]})},t.editarUser=function(n){t.template='<input type="text" ng-model="user.'+n+'">';r.show({template:t.template,title:l.instant("edit"),subTitle:"",scope:t,buttons:[{text:l.instant("cancel")},{text:"<b>"+l.instant("save")+"</b>",type:"button-positive",onTap:function(n){i.put(e.domain+"users/",t.user).then(function(e){t.user=e.data,o.localStorage.user=JSON.stringify(t.user)})}}]})},t.editarPassword=function(n){t.password={},t.password.new_password="",t.password.current_password="",t.template='<input type="password" ng-model="password.current_password" placeholder="Contraseña Actual"><br><input type="password" ng-model="password.new_password" placeholder="Nueva Contraseña">';r.show({template:t.template,title:"Editar ",subTitle:"",scope:t,buttons:[{text:"Cancelar"},{text:"<b>Guardar</b>",type:"button-positive",onTap:function(n){i.post(e.domain+"auth/password/",t.password).then(function(t){})}}]})},t.editarIdioma=function(n){t.perfil.idioma=n.codigo,i.put(e.domain+"userProfile/",t.perfil).then(function(e){t.perfil=e.data,o.localStorage.language=t.perfil.idioma}),l.use(n.codigo)}}]);