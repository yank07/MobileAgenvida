angular.module("Agenvida.controllerPerfil",[]).controller("controllerPerfil",["$scope","$rootScope","$state","$http","$window","$ionicHistory","$ionicPopup","$translate","ionicMaterialInk","ionicMaterialMotion","$timeout",function(t,e,i,n,o,a,r,l,s,c,p){t.goMarcacion=function(){i.go("marcacion")},t.goConfiguracion=function(){i.go("app.configuracion")},t.goContratoPedagogico=function(){i.go("app.contrato-pedagogico")},t.cerraSesion=function(){delete o.localStorage.token,delete o.localStorage.password,i.go("signin")},t.verRecordatorioMail=function(){i.go("app.recordatorio-mail")},t.verNotificaciones=function(){i.go("app.notificaciones")},t.idiomas=[{name:"Español",codigo:"es"},{name:"Ingles",codigo:"en"}],t.actualizar=function(i){i?(e.LoadingShow(),n.get(e.domain+"userProfile/").then(function(e){t.perfil=e.data,p(function(){s.displayEffect(),c.blinds()},50)},function(t){e.banner([l.instant("net_error"),l.instant("try_again")]),e.LoadingHide(),p(function(){s.displayEffect(),c.blinds()},50)}),n.get(e.domain+"users/").then(function(i){t.user=i.data,o.localStorage.user=JSON.stringify(t.user),e.LoadingHide()},function(t){e.LoadingHide(),e.banner([l.instant("net_error"),l.instant("try_again")])}),t.$broadcast("scroll.refreshComplete")):o.localStorage.perfil&&o.localStorage.user?(t.perfil=JSON.parse(o.localStorage.perfil),t.user=JSON.parse(o.localStorage.user),p(function(){s.displayEffect(),c.ripple()},100)):t.actualizar(!0)},t.editar=function(i){"nacimiento"==i?(t.inputType="date",null!=t.perfil.nacimiento?(t.nacimiento=t.perfil.nacimiento.split("-"),t.nacimiento=new Date(t.nacimiento[0],t.nacimiento[1]-1,t.nacimiento[2])):t.nacimiento=new Date(1990,10,18),t.perfil.nacimiento=t.nacimiento):t.inputType="text","reafirmar"==i||"adquirir"==i||"liberar"==i?t.template='<textarea ng-model="perfil.'+i+'" rows="4"></textarea>':t.template='<input type="'+t.inputType+'" ng-model="perfil.'+i+'">';r.show({template:t.template,title:l.instant("edit"),subTitle:"",scope:t,buttons:[{text:l.instant("cancel")},{text:"<b>"+l.instant("save")+"</b>",type:"button-positive",onTap:function(a){"nacimiento"==i?(t.nacimiento=t.perfil.nacimiento.getFullYear()+"-"+(t.perfil.nacimiento.getMonth()+1)+"-"+t.perfil.nacimiento.getDate(),data={nacimiento:t.nacimiento},n.put(e.domain+"userProfile/",data).then(function(e){t.perfil=e.data})):n.put(e.domain+"userProfile/",t.perfil).then(function(e){t.perfil=e.data}),o.localStorage.perfil=JSON.stringify(t.perfil)}}]})},t.editarUser=function(i){t.template='<input type="text" ng-model="user.'+i+'">';r.show({template:t.template,title:l.instant("edit"),subTitle:"",scope:t,buttons:[{text:l.instant("cancel")},{text:"<b>"+l.instant("save")+"</b>",type:"button-positive",onTap:function(i){n.put(e.domain+"users/",t.user).then(function(e){t.user=e.data,o.localStorage.user=JSON.stringify(t.user)})}}]})},t.editarPassword=function(i){t.password={},t.password.new_password="",t.password.current_password="",t.template='<input type="password" ng-model="password.current_password" placeholder="Contraseña Actual"><br><input type="password" ng-model="password.new_password" placeholder="Nueva Contraseña">';r.show({template:t.template,title:"Editar ",subTitle:"",scope:t,buttons:[{text:"Cancelar"},{text:"<b>Guardar</b>",type:"button-positive",onTap:function(i){n.post(e.domain+"auth/password/",t.password).then(function(t){})}}]})},t.editarIdioma=function(i){t.perfil.idioma=i.codigo,n.put(e.domain+"userProfile/",t.perfil).then(function(e){t.perfil=e.data,o.localStorage.language=t.perfil.idioma}),l.use(i.codigo)}}]);